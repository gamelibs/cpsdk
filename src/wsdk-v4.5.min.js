"use strict";window.w_success=null,window.w_failure=null,window.w_preload=null,window.w_timerNow=0,window.w_AutoAding=!1,window.w_LastInteractionAdTime=0,window.w_isStart=!0,window.w_isPreroll=!0,window.w_isPreloadAd=!1,window.w_isShowAd=!1,window.w_isShowAdTime=function(){return setTimeout((()=>{window.w_isShowAd=!1}),3e3),window.w_isShowAd};var wop=wop||{},wsdk=window.wsdk=wsdk||{};wsdk.wgtag=null,wsdk.wgtaglist=[],wsdk.ading=!1,wsdk.rewardNum=0,wsdk.adover={rewarded:!1,interstitial:!1},wsdk._ready=!1,wsdk._callbacks=[],wsdk._events={},wsdk._stickyEvents={adReady:!0},wsdk._lastEventPayload={},wsdk.hasEmitted=e=>!!(wsdk._stickyEvents&&wsdk._stickyEvents[e]&&Object.prototype.hasOwnProperty.call(wsdk._lastEventPayload,e)),wsdk.config={appId:null,apiKey:null,instanceId:null,templateId:null,endpoints:{}},wsdk.gamelog=function(e){console.log("[wsdk]",...arguments)},wsdk.gameDot=(e,t="")=>{if(wop.isDot)switch(e){case DOT.GAME_START:wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),{game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel,enter_game:t},e),upTimer();break;case DOT.AD_ERROR:wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),{game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel,ad_error_type:t},e);break;case DOT.LEVEL_START:wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),{level_name:t.name,game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel},e);break;case DOT.LEVEL_END:wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),{level_name:t.level_name,success:t.success,score:t.score,game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel},e);break;default:wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),{game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel,info:t},e)}else wsdk.gamelog("No dot",e,t)},wsdk.wgtag=function(e){return function(){let t=Array.from(arguments);try{if(void 0!==wop){let e=t[2];e.env=wop.env||"--",e.lang=wop.lang||"--",e.href=wop.href||"--";wop.gameId,t[0],t[1]}}catch(e){wsdk.gamelog(e)}e&&e.apply(this,arguments)}}((function(){}));var adInstance,isTimeOut=!0,mTimeOut=!0,adReadyFallbackTimer=null;function loadsdk(e){return new Promise(((t,a)=>{const n=document.createElement("script");n.async=!0,n.src=e,n.onload=()=>t(!0),n.onerror=()=>a(new Error("脚本加载失败: "+e)),document.head.appendChild(n)}))}var w_script={onload:null,onerror:null};let plurl="https://www.cpsense.com/public/PRESDK3.0.1.js";loadsdk(plurl).then((()=>{console.log("加载成功"),w_script.onload()})).catch((e=>{console.error(e),w_script.onerror(),wsdk.startGame()})),w_script.onload=function(){console.log("loaded ads"),adReadyFallbackTimer&&clearTimeout(adReadyFallbackTimer),adReadyFallbackTimer=setTimeout((()=>{wsdk.hasEmitted("adReady")||wsdk.emit("adReady")}),2e3);const e={el:document.querySelector("#adcontent"),client:wop.channel||wop.adChannel,is_test:wop.w_test||!1};adInstance=new adSdk(e);try{adInstance._eventAds.on("ready",(()=>{console.log("ad sdk ready"),adReadyFallbackTimer&&(clearTimeout(adReadyFallbackTimer),adReadyFallbackTimer=null),wsdk.hasEmitted("adReady")||wsdk.emit("adReady")}))}catch(e){console.log("ad init err",e)}let t=setTimeout((function(){clearTimeout(t),wop.firstAdClick?wop.show_PlayNow():wop.firstAd&&wsdk.showAd("fristad").then((()=>{console.log("fristad done")})).catch((e=>{console.log("fristad err",e)}))}),2e3);wsdk.gameDot(W_DOT.AD_LOAD,"sdk load yes")},w_script.onerror=function(){wsdk.gameDot(W_DOT.AD_LOAD_ERROR,"sdk load no"),adReadyFallbackTimer&&clearTimeout(adReadyFallbackTimer),adReadyFallbackTimer=setTimeout((()=>{wsdk.hasEmitted("adReady")||wsdk.emit("adReady")}),2e3)};let gamecallback=null;wsdk.startGame=()=>{if(!w_isStart)return;w_isStart=!1,console.log("game start"),wop.firstAdClick&&wop.hide_PlayNow(),gamecallback&&gamecallback(),gamecallback=null;let e=Date.now()/1e3;if(window.w_LastInteractionAdTime=Date.now()/1e3,window.addEventListener?window.addEventListener("mousemove",(function(t){e=(new Date).getTime()/1e3,t.returnValue=e})):window.attachEvent&&window.attachEvent("mousemove",(function(){e=(new Date).getTime()/1e3,window.event.returnValue=e})),wop.w_isAutoAd){let t=wop.autoTime||35,a=60;window.w_AutoAding=!1,setInterval((()=>{const n=(new Date).getTime()/1e3,o=n-e;window.w_AutoAding&&(e=n),o>t&&!window.w_AutoAding&&("function"==typeof wsdk.gamelog&&wsdk.gamelog("AutoAd",t,window.w_AutoAding),e=n,void 0!==wop&&wop.trigger("interstitial"));const d=n-w_LastInteractionAdTime;window.w_AutoAding&&(w_LastInteractionAdTime=n),d>a&&!window.w_AutoAding&&("function"==typeof wsdk.gamelog&&wsdk.gamelog("AutoAd",a,!window.w_AutoAding),w_LastInteractionAdTime=n,void 0!==wop&&wop.trigger("interstitial"))}),1e3)}},wsdk.initAd=e=>{wsdk.gameDot(W_DOT.GAME_OPEN,"open_game"),e&&(gamecallback=e),!wop.firstAd&&gamecallback()},wsdk.dotga=(e,t,a)=>{wop.isDotWGA&&e&&e(t),"function"==typeof window.gtag&&window.gtag("event",a,t)},wsdk.prob=e=>{if(0===e)return!1;if(1===e)return!0;{let t=Math.random();return wsdk.gamelog(t),t<e}};let timeShowTimer=null;wsdk.showAd=(e,t)=>timeShowTimer?new Promise(((e,t)=>{e(!1)})):(timeShowTimer=setTimeout((()=>{clearTimeout(timeShowTimer),timeShowTimer=null}),500),"undefined"!=typeof wother&&wother&&wother(!0),window.w_isShowAdTime()?new Promise((function(e,a){e("error"),t&&t(),"undefined"!=typeof wother&&wother&&wother(!1)})):(window.w_isShowAd=!0,new Promise(((a,n)=>{if("dev"===wop.env)return"undefined"!=typeof wother&&wother&&wother(!1),a(),void(t&&t());function o(){wsdk.ading=!1}function d(e){a("success"),"undefined"!=typeof wother&&wother&&wother(!1),o(),e?wsdk.startGame():(window.w_AutoAding=!1,window.w_LastInteractionAdTime=(new Date).getTime()/1e3)}function r(e,a){o(),"undefined"!=typeof wother&&wother&&wother(!1),!t&&n&&n("nil"),a?wsdk.startGame():(window.w_AutoAding=!1,window.w_LastInteractionAdTime=(new Date).getTime()/1e3)}if(wsdk.ading=!0,window.w_AutoAding=!0,e||(e="interstitial"),"rewarded"===(e=e.toLowerCase())&&(wsdk.gameDot(DOT.GAME_REWARD),function(e){const t=setTimeout((()=>{clearTimeout(t),a||(wsdk.gameDot(DOT.AD_ERROR,"video timerout"),e&&e("afterAd-v-no"),r())}),4e3);let a=!1;adInstance.rewardAd({beforeAd(){a=!0,wsdk.gameDot(DOT.GAME_REWARD_OPEN,"ad reward open"),e&&e("beforeAd")},adDismissed(){a=!0,wsdk.gameDot(DOT.GAME_REWARD_DISMISSED),e&&e("afterAd-v-no"),window.success&&window.success(!1),window.failure&&window.failure(!1),r()},adViewed(){a=!0,wsdk.gameDot(DOT.GAME_REWARD_VIEWED),e&&e("afterAd-v-yes"),window.success&&window.success(!0),d()},error(t){a=!0,wsdk.gameDot(DOT.AD_ERROR,"video"+t),e&&e("afterAd-Error-no"),r()}})}(t)),"interstitial"===e){if(!wsdk.prob(wop.adProb))return a(),void(t&&t());wsdk.gameDot(DOT.GAME_INTERSTITIAL),function(e){let t=!1;const a=setTimeout((()=>{clearTimeout(a),t||(wsdk.gameDot(DOT.AD_ERROR,"inter timeout"),e&&e("afterAd-Error-no"),r())}),4e3);adInstance&&adInstance.interstitialAd({beforeAd(){t=!0,wsdk.gameDot(DOT.GAME_INTERSTITIAL_OPEN,"ad open");try{wsdk.pauseAllAudio&&wsdk.pauseAllAudio()}catch(e){}e&&e("beforeAd"),window.w_AutoAding=!0},afterAd(){t=!0,wsdk.gameDot(DOT.GAME_INTERSTITIAL_VIEWED,"afterAd viewed");try{wsdk.resumeAllAudio&&wsdk.resumeAllAudio()}catch(e){}e&&e("afterAd-yes"),d()},error(a){t=!0,wsdk.gameDot(DOT.AD_ERROR,a);try{wsdk.resumeAllAudio&&wsdk.resumeAllAudio()}catch(e){}e&&e("afterAd-Error-no"),r()}})}(t)}if("fristad"===e){if(wsdk.rewardNum++,!wsdk.prob(wop.adProb))return a(),void(gamecallback&&gamecallback());wsdk.gameDot(DOT.GAME_INTERSTITIAL,"fristad"),function(){let e=!1;const t=setTimeout((()=>{clearTimeout(t),e||(wsdk.gamelog("fristad timeout 3s"),wsdk.gameDot(DOT.AD_ERROR,"fristad timeout"),r(0,!0))}),3e3);try{adInstance.interstitialAd({beforeAd(){e=!0,"undefined"!=typeof gamebox&&(gamebox.style.display="none"),wsdk.gameDot(DOT.GAME_INTERSTITIAL_OPEN,"fristad open")},afterAd(){e=!0,wsdk.gameDot(DOT.GAME_INTERSTITIAL_VIEWED,"fristad viewed"),"undefined"!=typeof gamebox&&(gamebox.style.display="block"),d(!0)},error(t){e=!0,wsdk.gamelog("fristad",t),wsdk.gameDot(DOT.AD_ERROR,"fristad "+t),r(0,!0)}})}catch(e){console.log("fristad error",e)}}()}})))),wsdk.preloadAd=(e,t)=>window.w_isPreloadAd?new Promise((function(e,t){e("error")})):(window.w_isPreloadAd=!0,new Promise((function(a,n){wsdk.showAd(e,(()=>{if("function"==typeof t)try{window.w_isPreloadAd=!1,t&&t(),a(!0)}catch(e){n(e)}a("Ads Loaded",e)})).catch((()=>{}))}))),wsdk.gameplay=e=>{let t=window.GD_OPTIONS||window.SDK_OPTIONS;t&&("start"===e&&t.onEvent({message:"",name:"SDK_GAME_START",status:"success"}),"pause"===e&&t.onEvent({message:"",name:"SDK_GAME_PAUSE",status:"success"}))},wsdk.AdType={interstitial:"interstitial",rewarded:"rewarded",Interstitial:"Interstitial",Rewarded:"Rewarded"},wsdk.adType={interstitial:"interstitial",rewarded:"rewarded",Interstitial:"Interstitial",Rewarded:"Rewarded"},wsdk.getSession=()=>"session null";const DOT={GAME_START:"game_start",GAME_PLAY_TIME:"game_play_time",GAME_REWARD:"game_reward",GAME_REWARD_VIEWED:"game_reward_viewed",GAME_REWARD_OPEN:"game_reward_open",GAME_REWARD_DISMISSED:"game_reward_dismissed",GAME_INTERSTITIAL:"game_interstitialad",GAME_INTERSTITIAL_OPEN:"game_interstitialad_open",GAME_INTERSTITIAL_VIEWED:"game_interstitialad_viewed",LEVEL_START:"level_start",LEVEL_END:"level_end",AD_ERROR:"ad_error",GAME_RANK_SCORE:"game_rank_score"};wsdk.DOT=DOT;const W_DOT={AD_INIT:"ad_init",AD_OPEN:"ad_open",AD_OPEN_ERROR:"ad_open_error",AD_LOAD:"ad_load",AD_LOAD_ERROR:"ad_load_error",AD_BACK_TYPE:"ad_back_type",GAME_OPEN:"game_open"};function upTimer(){wop.isDuration&&setInterval((()=>{wsdk.gameDot(DOT.GAME_PLAY_TIME)}),3e4)}function dotPower(e,t){}wsdk.W_DOT=W_DOT,wsdk.getItem=e=>{try{const t=window.localStorage.getItem(e);if(null==t)return null;try{return JSON.parse(t)}catch(e){return t}}catch(e){return null}},wsdk.setItem=(e,t)=>{try{const a="string"==typeof t?t:JSON.stringify(t);return window.localStorage.setItem(e,a),!0}catch(e){return!1}},wsdk.readIndexedDB=async(e,t="keyvaluepairs",a)=>{try{const o=await(n=e,new Promise(((e,t)=>{try{const a=indexedDB.open(n);a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error),a.onupgradeneeded=()=>{}}catch(e){t(e)}})));let d;d=void 0===a?await((e,t)=>new Promise(((a,n)=>{try{const o=e.transaction(t,"readonly").objectStore(t).getAll();o.onsuccess=()=>a(o.result),o.onerror=()=>n(o.error)}catch(e){n(e)}})))(o,t):await((e,t,a)=>new Promise(((n,o)=>{try{const d=e.transaction(t,"readonly").objectStore(t).get(a);d.onsuccess=()=>n(d.result),d.onerror=()=>o(d.error)}catch(e){o(e)}})))(o,t,a);const r=e=>{const t=e&&(e.value??e)||e;if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t};return void 0===a?Array.isArray(d)?d.map(r):d:null==d?null:r(d)}catch(e){return this.__sdklog("readIndexedDB error",e&&e.message?e.message:e),null}var n},wsdk.on=(e,t)=>{if(wsdk._events[e]||(wsdk._events[e]=[]),wsdk._events[e].push(t),wsdk._stickyEvents[e]&&Object.prototype.hasOwnProperty.call(wsdk._lastEventPayload,e))try{t(wsdk._lastEventPayload[e])}catch(e){}},wsdk.off=(e,t)=>{if(!wsdk._events[e])return;if(!t)return void delete wsdk._events[e];const a=wsdk._events[e].indexOf(t);a>-1&&wsdk._events[e].splice(a,1)},wsdk.emit=(e,t)=>{wsdk._stickyEvents[e]&&(wsdk._lastEventPayload[e]=t);const a=wsdk._events[e]||[],n=t&&"object"==typeof t?Object.keys(t).map((e=>`${e}: ${t[e]}`)).join(", "):String(t||"");console.log(`[wsdk] Event: ${e}${n?", "+n:""}`),a.forEach((e=>{try{e(t)}catch(e){}}))},wsdk.watchStorage=(e,t,a=2e3)=>{if("undefined"==typeof window||void 0===window.localStorage||null==window.localStorage)return()=>{};let n=null;const o=setInterval((()=>{try{const a=window.localStorage.getItem(e);if(a!==n){let o=null;try{o=wsdk.getItem?wsdk.getItem(e):null==a?null:JSON.parse(a)}catch(e){o=a}let d=null;try{d=null==n||wsdk.getItem?null:JSON.parse(n)}catch(e){d=n}const r=function(e,t){try{return JSON.stringify(e)!==JSON.stringify(t)}catch(a){return e!==t}}(o,d);if(null!=o&&r)try{t(o)}catch(e){}n=a}}catch(e){}}),a);return()=>clearInterval(o)},wsdk.trackEvent=async(e,t={})=>{wsdk.gameDot(e,t)},wsdk.trackLevelEnd=async(e={})=>{const t={level_name:e.level_name||0,success:e.success||!1,score:e.score||0,best:e.best||0,game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel};return await wsdk.trackEvent("level_end",t)},wsdk.trackScore=async(e={})=>{let t,a;if("number"==typeof e)t=e,a={score:e};else{if(!e||"number"!=typeof e.score)return{delivered:!1,reason:"invalid_score"};t=e.score,a=e}return null==t?{delivered:!1,reason:"invalid_score"}:await wsdk.trackEvent("game_score",a)},wsdk.trackLevel=async(e={})=>{let t,a;if("number"==typeof e)t=e,a={level:e};else{if(!e||"number"!=typeof e.level)return{delivered:!1,reason:"invalid_level"};t=e.level,a=e}return null==t?{delivered:!1,reason:"invalid_level"}:await wsdk.trackEvent("level",a)},wsdk.watchIndexedDB=(e,t="keyvaluepairs",a,n,o=2e3)=>{if("undefined"==typeof window||void 0===window.wsdk||"function"!=typeof window.wsdk.readIndexedDB)return()=>{};const d=Array.isArray(e)?e.slice():[e];let r=null,s=null,w=!1;const i=e=>{try{return e instanceof ArrayBuffer?`ArrayBuffer:${e.byteLength}`:e instanceof Blob?`Blob:${e.size}:${e.type}`:JSON.stringify(e)}catch(t){try{return String(e)}catch(e){return"UNSERIALIZABLE"}}},l=async()=>{if(!w)try{if(r)try{const e=await window.wsdk.readIndexedDB(r,t,a),o=i(e);if(o!==s&&(s=o,null!=e))try{n(e,{db:r})}catch(e){console.error("watchIndexedDB callback error",e)}}catch(e){r=null}else for(const e of d)try{const o=await window.wsdk.readIndexedDB(e,t,a);if(null!=o&&(!Array.isArray(o)||o.length>0)){r=e;const t=i(o);if(t!==s){s=t;try{n(o,{db:r})}catch(e){console.error("watchIndexedDB callback error",e)}}break}}catch(e){}}catch(e){console.error("watchIndexedDB probe error",e)}};l();const c=setInterval(l,o);return()=>{w=!0,clearInterval(c)}};