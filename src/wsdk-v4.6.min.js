"use strict";window.w_success=null,window.w_failure=null,window.w_preload=null,window.w_timerNow=0,window.w_AutoAding=!1,window.w_LastInteractionAdTime=0,window.w_isStart=!0,window.w_isPreroll=!0,window.w_isPreloadAd=!1,window.w_isShowAd=!1,window.w_isShowAdTime=function(){return setTimeout((()=>{window.w_isShowAd=!1}),3e3),window.w_isShowAd};var wop="undefined"!=typeof window&&window.wop?window.wop:window.wop=window.wop||{},wsdk=window.wsdk=wsdk||{};wsdk.wgtag=null,wsdk.wgtaglist=[],wsdk.ading=!1,wsdk.rewardNum=0,wsdk.adover={rewarded:!1,interstitial:!1},wsdk._ready=!1,wsdk._callbacks=[],wsdk._events={},wsdk._stickyEvents={adReady:!0},wsdk._lastEventPayload={},wsdk.hasEmitted=e=>!!(wsdk._stickyEvents&&wsdk._stickyEvents[e]&&Object.prototype.hasOwnProperty.call(wsdk._lastEventPayload,e)),wsdk.config={appId:null,apiKey:null,instanceId:null,templateId:null,endpoints:{}},wsdk.gamelog=function(e){console.log("[wsdk]",...arguments)},wsdk._preDotQueue=Array.isArray(wsdk._preDotQueue)?wsdk._preDotQueue:[];var __wsdkPreDotQueue=wsdk._preDotQueue.slice();if(wsdk._preDotQueue.length=0,wsdk._hasGtag=()=>{try{return"function"==typeof window.gtag}catch(e){return!1}},wsdk._waitForGtagReplay=(e=15e3,t=200)=>{if(wsdk._gtagReplayTimer)return;const a=Date.now();wsdk._gtagReplayTimer=setInterval((()=>{const t=Date.now()-a>e;if(wsdk._hasGtag()&&void 0!==wop.isDot)try{wsdk.replayPreDotQueue&&wsdk.replayPreDotQueue()}catch(e){}!t&&wsdk._preDotQueue.length||(clearInterval(wsdk._gtagReplayTimer),wsdk._gtagReplayTimer=null)}),t)},wsdk.replayPreDotQueue=()=>{if(!wsdk._hasGtag())return wsdk._waitForGtagReplay&&wsdk._waitForGtagReplay(),0;if(!Array.isArray(wsdk._preDotQueue)||!wsdk._preDotQueue.length)return 0;let e=0;const t=wsdk._preDotQueue.slice();return wsdk._preDotQueue.length=0,t.forEach((t=>{if(Array.isArray(t))try{wsdk.gameDot(t[0],t[1]),e++}catch(e){}})),e},wsdk._hasRealWgtag=()=>"function"==typeof wsdk.wgtag&&wsdk.wgtag&&!0!==wsdk.wgtag.__wsdkStub,wsdk.gameDot=(e,t="")=>{try{e=String(e)}catch(t){e=""}if(e=e.trim(),void 0!==wop.isDot)if(wop.isDot)if(wsdk._hasGtag()){switch(e){case DOT.GAME_START:var a={game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel,enter_game:t};wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),a,e);break;case DOT.AD_ERROR:a={game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel,ad_error_type:t};wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),a,e);break;case DOT.LEVEL_START:a={level_name:t.name,game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel};wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),a,e);break;case DOT.LEVEL_END:a={level_name:t.level_name,success:t.success,score:t.score,game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel};wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),a,e);break;default:a={game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel,info:t};wsdk.dotga((t=>{wsdk.wgtag("event",e,t)}),a,e)}console.log("gameDot",e,t)}else{try{wsdk._preDotQueue.push([e,t])}catch(e){}wsdk._waitForGtagReplay&&wsdk._waitForGtagReplay()}else wsdk.gamelog("No dot",e,t);else{try{wsdk._preDotQueue.push([e,t])}catch(e){}wsdk._waitForGtagReplay&&wsdk._waitForGtagReplay()}},Array.isArray(__wsdkPreDotQueue)&&__wsdkPreDotQueue.length){try{__wsdkPreDotQueue.forEach((e=>{Array.isArray(e)&&wsdk._preDotQueue.push(e)}))}catch(e){}if(__wsdkPreDotQueue.length=0,void 0!==wop.isDot)try{wsdk.replayPreDotQueue()}catch(e){}}wsdk.wgtag=function(e){return function(){let t=Array.from(arguments);try{if(void 0!==wop){let e=t[2];e.env=wop.env||"--",e.lang=wop.lang||"--",e.href=wop.href||"--";wop.gameId,t[0],t[1]}}catch(e){wsdk.gamelog(e)}e&&e.apply(this,arguments)}}((function(){}));try{wsdk.wgtag.__wsdkStub=!0}catch(e){}var adInstance,isTimeOut=!0,mTimeOut=!0,adReadyFallbackTimer=null;function loadsdk(e){return new Promise(((t,a)=>{const o=document.createElement("script");o.async=!0,o.src=e,o.onload=()=>t(!0),o.onerror=()=>a(new Error("脚本加载失败: "+e)),document.head.appendChild(o)}))}var w_script={onload:null,onerror:null};let plurl="https://www.cpsense.com/public/PRESDK3.0.1.js";loadsdk(plurl).then((()=>{console.log("加载成功"),w_script.onload()})).catch((e=>{console.error(e),w_script.onerror(),wsdk.startGame()})),w_script.onload=function(){console.log("loaded ads"),adReadyFallbackTimer&&clearTimeout(adReadyFallbackTimer),adReadyFallbackTimer=setTimeout((()=>{wsdk.hasEmitted("adReady")||wsdk.emit("adReady")}),2e3);const e={el:document.querySelector("#adcontent"),client:wop.channel||wop.adChannel,is_test:wop.w_test||!1};adInstance=new adSdk(e);try{adInstance._eventAds.on("ready",(()=>{console.log("ad sdk ready"),adReadyFallbackTimer&&(clearTimeout(adReadyFallbackTimer),adReadyFallbackTimer=null),wsdk.hasEmitted("adReady")||wsdk.emit("adReady")}))}catch(e){console.log("ad init err",e)}let t=setTimeout((function(){clearTimeout(t),wop.firstAdClick?wop.show_PlayNow():wop.firstAd&&wsdk.showAd("fristad").then((()=>{console.log("fristad done")})).catch((e=>{console.log("fristad err",e)}))}),2e3);wsdk.gameDot(W_DOT.AD_LOAD,"sdk load yes")},w_script.onerror=function(){wsdk.gameDot(W_DOT.AD_LOAD_ERROR,"sdk load no"),adReadyFallbackTimer&&clearTimeout(adReadyFallbackTimer),adReadyFallbackTimer=setTimeout((()=>{wsdk.hasEmitted("adReady")||wsdk.emit("adReady")}),2e3)};let gamecallback=null;wsdk.startGame=()=>{if(!w_isStart)return;w_isStart=!1,console.log("game start"),wop.firstAdClick&&wop.hide_PlayNow(),gamecallback&&gamecallback(),gamecallback=null;let e=Date.now()/1e3;if(window.w_LastInteractionAdTime=Date.now()/1e3,window.addEventListener?window.addEventListener("mousemove",(function(t){e=(new Date).getTime()/1e3,t.returnValue=e})):window.attachEvent&&window.attachEvent("mousemove",(function(){e=(new Date).getTime()/1e3,window.event.returnValue=e})),wop.w_isAutoAd){let t=wop.autoTime||35,a=60;window.w_AutoAding=!1,setInterval((()=>{const o=(new Date).getTime()/1e3,r=o-e;window.w_AutoAding&&(e=o),r>t&&!window.w_AutoAding&&("function"==typeof wsdk.gamelog&&wsdk.gamelog("AutoAd",t,window.w_AutoAding),e=o,void 0!==wop&&wop.trigger("interstitial"));const d=o-w_LastInteractionAdTime;window.w_AutoAding&&(w_LastInteractionAdTime=o),d>a&&!window.w_AutoAding&&("function"==typeof wsdk.gamelog&&wsdk.gamelog("AutoAd",a,!window.w_AutoAding),w_LastInteractionAdTime=o,void 0!==wop&&wop.trigger("interstitial"))}),1e3)}},wsdk.initAd=e=>{wsdk.gameDot(W_DOT.GAME_OPEN,"open_game"),e&&(gamecallback=e),!wop.firstAd&&gamecallback()},wsdk.dotga=(e,t,a)=>{let o=!1;try{void 0!==wop&&wop.isDotWGA&&wsdk._hasRealWgtag()&&("function"==typeof e?e(t):wsdk.wgtag("event",a,t),o=!0)}catch(e){}try{"function"==typeof window.gtag&&(window.gtag("event",a,t),o=!0)}catch(e){}return o},wsdk.prob=e=>{if(0===e)return!1;if(1===e)return!0;{let t=Math.random();return wsdk.gamelog(t),t<e}};let timeShowTimer=null;wsdk.showAd=(e,t)=>timeShowTimer?new Promise(((e,t)=>{e(!1)})):(timeShowTimer=setTimeout((()=>{clearTimeout(timeShowTimer),timeShowTimer=null}),500),"undefined"!=typeof wother&&wother&&wother(!0),window.w_isShowAdTime()?new Promise((function(e,a){e("error"),t&&t(),"undefined"!=typeof wother&&wother&&wother(!1)})):(window.w_isShowAd=!0,new Promise(((a,o)=>{if("dev"===wop.env)return"undefined"!=typeof wother&&wother&&wother(!1),a(),void(t&&t());function r(){wsdk.ading=!1}function d(e){a("success"),"undefined"!=typeof wother&&wother&&wother(!1),r(),e?wsdk.startGame():(window.w_AutoAding=!1,window.w_LastInteractionAdTime=(new Date).getTime()/1e3)}function n(e,a){r(),"undefined"!=typeof wother&&wother&&wother(!1),!t&&o&&o("nil"),a?wsdk.startGame():(window.w_AutoAding=!1,window.w_LastInteractionAdTime=(new Date).getTime()/1e3)}if(wsdk.ading=!0,window.w_AutoAding=!0,e||(e="interstitial"),"rewarded"===(e=e.toLowerCase())&&(wsdk.gameDot(DOT.GAME_REWARD),function(e){const t=setTimeout((()=>{clearTimeout(t),a||(wsdk.gameDot(DOT.AD_ERROR,"video timerout"),e&&e("afterAd-v-no"),n())}),4e3);let a=!1;adInstance.rewardAd({beforeAd(){a=!0,wsdk.gameDot(DOT.GAME_REWARD_OPEN,"ad reward open"),e&&e("beforeAd")},adDismissed(){a=!0,wsdk.gameDot(DOT.GAME_REWARD_DISMISSED),e&&e("afterAd-v-no"),window.success&&window.success(!1),window.failure&&window.failure(!1),n()},adViewed(){a=!0,wsdk.gameDot(DOT.GAME_REWARD_VIEWED),e&&e("afterAd-v-yes"),window.success&&window.success(!0),d()},error(t){a=!0,wsdk.gameDot(DOT.AD_ERROR,"video"+t),e&&e("afterAd-Error-no"),n()}})}(t)),"interstitial"===e){if(!wsdk.prob(wop.adProb))return a(),void(t&&t());wsdk.gameDot(DOT.GAME_INTERSTITIAL),function(e){let t=!1;const a=setTimeout((()=>{clearTimeout(a),t||(wsdk.gameDot(DOT.AD_ERROR,"inter timeout"),e&&e("afterAd-Error-no"),n())}),4e3);adInstance&&adInstance.interstitialAd({beforeAd(){t=!0,wsdk.gameDot(DOT.GAME_INTERSTITIAL_OPEN,"ad open");try{wsdk.pauseAllAudio&&wsdk.pauseAllAudio()}catch(e){}e&&e("beforeAd"),window.w_AutoAding=!0},afterAd(){t=!0,wsdk.gameDot(DOT.GAME_INTERSTITIAL_VIEWED,"afterAd viewed");try{wsdk.resumeAllAudio&&wsdk.resumeAllAudio()}catch(e){}e&&e("afterAd-yes"),d()},error(a){t=!0,wsdk.gameDot(DOT.AD_ERROR,a);try{wsdk.resumeAllAudio&&wsdk.resumeAllAudio()}catch(e){}e&&e("afterAd-Error-no"),n()}})}(t)}if("fristad"===e){if(wsdk.rewardNum++,!wsdk.prob(wop.adProb))return a(),void(gamecallback&&gamecallback());wsdk.gameDot(DOT.GAME_INTERSTITIAL,"fristad"),function(){let e=!1;const t=setTimeout((()=>{clearTimeout(t),e||(wsdk.gamelog("fristad timeout 3s"),wsdk.gameDot(DOT.AD_ERROR,"fristad timeout"),n(0,!0))}),3e3);try{adInstance.interstitialAd({beforeAd(){e=!0,"undefined"!=typeof gamebox&&(gamebox.style.display="none"),wsdk.gameDot(DOT.GAME_INTERSTITIAL_OPEN,"fristad open")},afterAd(){e=!0,wsdk.gameDot(DOT.GAME_INTERSTITIAL_VIEWED,"fristad viewed"),"undefined"!=typeof gamebox&&(gamebox.style.display="block"),d(!0)},error(t){e=!0,wsdk.gamelog("fristad",t),wsdk.gameDot(DOT.AD_ERROR,"fristad "+t),n(0,!0)}})}catch(e){console.log("fristad error",e)}}()}})))),wsdk.preloadAd=(e,t)=>window.w_isPreloadAd?new Promise((function(e,t){e("error")})):(window.w_isPreloadAd=!0,new Promise((function(a,o){wsdk.showAd(e,(()=>{if("function"==typeof t)try{window.w_isPreloadAd=!1,t&&t(),a(!0)}catch(e){o(e)}a("Ads Loaded",e)})).catch((()=>{}))}))),wsdk.gameplay=e=>{let t=window.GD_OPTIONS||window.SDK_OPTIONS;t&&("start"===e&&t.onEvent({message:"",name:"SDK_GAME_START",status:"success"}),"pause"===e&&t.onEvent({message:"",name:"SDK_GAME_PAUSE",status:"success"}))},wsdk.AdType={interstitial:"interstitial",rewarded:"rewarded",Interstitial:"Interstitial",Rewarded:"Rewarded"},wsdk.adType={interstitial:"interstitial",rewarded:"rewarded",Interstitial:"Interstitial",Rewarded:"Rewarded"},wsdk.getSession=()=>"session null";const DOT={GAME_START:"game_start",GAME_REWARD:"game_reward",GAME_REWARD_VIEWED:"game_reward_viewed",GAME_REWARD_OPEN:"game_reward_open",GAME_REWARD_DISMISSED:"game_reward_dismissed",GAME_INTERSTITIAL:"game_interstitialad",GAME_INTERSTITIAL_OPEN:"game_interstitialad_open",GAME_INTERSTITIAL_VIEWED:"game_interstitialad_viewed",LEVEL_START:"level_start",LEVEL_END:"level_end",AD_ERROR:"ad_error",GAME_RANK_SCORE:"game_rank_score"};wsdk.DOT=DOT;const W_DOT={AD_INIT:"ad_init",AD_OPEN:"ad_open",AD_OPEN_ERROR:"ad_open_error",AD_LOAD:"ad_load",AD_LOAD_ERROR:"ad_load_error",AD_BACK_TYPE:"ad_back_type",GAME_OPEN:"game_open"};function dotPower(e,t){}wsdk.W_DOT=W_DOT,wsdk.getItem=e=>{try{const t=window.localStorage.getItem(e);if(null==t)return null;try{return JSON.parse(t)}catch(e){return t}}catch(e){return null}},wsdk.setItem=(e,t)=>{try{const a="string"==typeof t?t:JSON.stringify(t);return window.localStorage.setItem(e,a),!0}catch(e){return!1}},wsdk.readIndexedDB=async(e,t="keyvaluepairs",a)=>{try{const r=await(o=e,new Promise(((e,t)=>{try{const a=indexedDB.open(o);a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error),a.onupgradeneeded=()=>{}}catch(e){t(e)}})));let d;d=void 0===a?await((e,t)=>new Promise(((a,o)=>{try{const r=e.transaction(t,"readonly").objectStore(t).getAll();r.onsuccess=()=>a(r.result),r.onerror=()=>o(r.error)}catch(e){o(e)}})))(r,t):await((e,t,a)=>new Promise(((o,r)=>{try{const d=e.transaction(t,"readonly").objectStore(t).get(a);d.onsuccess=()=>o(d.result),d.onerror=()=>r(d.error)}catch(e){r(e)}})))(r,t,a);const n=e=>{const t=e&&(e.value??e)||e;if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t}return t};return void 0===a?Array.isArray(d)?d.map(n):d:null==d?null:n(d)}catch(e){return this.__sdklog("readIndexedDB error",e&&e.message?e.message:e),null}var o},wsdk.on=(e,t)=>{if(wsdk._events[e]||(wsdk._events[e]=[]),wsdk._events[e].push(t),wsdk._stickyEvents[e]&&Object.prototype.hasOwnProperty.call(wsdk._lastEventPayload,e))try{t(wsdk._lastEventPayload[e])}catch(e){}},wsdk.off=(e,t)=>{if(!wsdk._events[e])return;if(!t)return void delete wsdk._events[e];const a=wsdk._events[e].indexOf(t);a>-1&&wsdk._events[e].splice(a,1)},wsdk.emit=(e,t)=>{wsdk._stickyEvents[e]&&(wsdk._lastEventPayload[e]=t);const a=wsdk._events[e]||[],o=t&&"object"==typeof t?Object.keys(t).map((e=>`${e}: ${t[e]}`)).join(", "):String(t||"");console.log(`[wsdk] Event: ${e}${o?", "+o:""}`),a.forEach((e=>{try{e(t)}catch(e){}}))},wsdk.watchStorage=(e,t,a=2e3)=>{if("undefined"==typeof window||void 0===window.localStorage||null==window.localStorage)return()=>{};let o=null;const r=setInterval((()=>{try{const a=window.localStorage.getItem(e);if(a!==o){let r=null;try{r=wsdk.getItem?wsdk.getItem(e):null==a?null:JSON.parse(a)}catch(e){r=a}let d=null;try{d=null==o||wsdk.getItem?null:JSON.parse(o)}catch(e){d=o}const n=function(e,t){try{return JSON.stringify(e)!==JSON.stringify(t)}catch(a){return e!==t}}(r,d);if(null!=r&&n)try{t(r)}catch(e){}o=a}}catch(e){}}),a);return()=>clearInterval(r)},wsdk.trackEvent=async(e,t={})=>{wsdk.gameDot(e,t)},wsdk.trackLevelEnd=async(e={})=>{const t={level_name:e.level_name||0,success:e.success||!1,score:e.score||0,best:e.best||0,game_name:wop.gameTitle,dev_name:wop.channel||wop.adChannel};return await wsdk.trackEvent("level_end",t)},wsdk.trackScore=async(e={})=>{let t,a;if("number"==typeof e)t=e,a={score:e};else{if(!e||"number"!=typeof e.score)return{delivered:!1,reason:"invalid_score"};t=e.score,a=e}return null==t?{delivered:!1,reason:"invalid_score"}:await wsdk.trackEvent("game_score",a)},wsdk.trackLevel=async(e={})=>{let t,a;if("number"==typeof e)t=e,a={level:e};else{if(!e||"number"!=typeof e.level)return{delivered:!1,reason:"invalid_level"};t=e.level,a=e}return null==t?{delivered:!1,reason:"invalid_level"}:await wsdk.trackEvent("level",a)},wsdk.watchIndexedDB=(e,t="keyvaluepairs",a,o,r=2e3)=>{if("undefined"==typeof window||void 0===window.wsdk||"function"!=typeof window.wsdk.readIndexedDB)return()=>{};const d=Array.isArray(e)?e.slice():[e];let n=null,s=null,w=!1;const i=e=>{try{return e instanceof ArrayBuffer?`ArrayBuffer:${e.byteLength}`:e instanceof Blob?`Blob:${e.size}:${e.type}`:JSON.stringify(e)}catch(t){try{return String(e)}catch(e){return"UNSERIALIZABLE"}}},l=async()=>{if(!w)try{if(n)try{const e=await window.wsdk.readIndexedDB(n,t,a),r=i(e);if(r!==s&&(s=r,null!=e))try{o(e,{db:n})}catch(e){console.error("watchIndexedDB callback error",e)}}catch(e){n=null}else for(const e of d)try{const r=await window.wsdk.readIndexedDB(e,t,a);if(null!=r&&(!Array.isArray(r)||r.length>0)){n=e;const t=i(r);if(t!==s){s=t;try{o(r,{db:n})}catch(e){console.error("watchIndexedDB callback error",e)}}break}}catch(e){}}catch(e){console.error("watchIndexedDB probe error",e)}};l();const c=setInterval(l,r);return()=>{w=!0,clearInterval(c)}};